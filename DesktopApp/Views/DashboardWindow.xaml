<Window x:Class="DesktopApp.Views.DashboardWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="IPTV Dashboard" Height="600" Width="1200" Background="#0D1117" WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <Border Background="#131C27" Grid.Row="0" Padding="14 0" >
            <DockPanel>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="IPTV Dashboard" FontSize="18" FontWeight="Bold" Foreground="#F0F6FC"/>
                    <TextBlock Text="  -  Last EPG:" Foreground="#8BA1B9" Margin="14 0 4 0"/>
                    <TextBlock Text="{Binding LastEpgUpdateText}" Foreground="#DDE6F2"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button Content="Settings" Margin="0 0 12 0" Click="OpenSettings_Click" ToolTip="Open settings"/>
                    <TextBlock Text="User:" Margin="4 0 4 0" Foreground="#8BA1B9"/>
                    <TextBlock x:Name="UserNameText" Foreground="#DDE6F2" Margin="0 0 12 0"/>
                    <Button Content="Logout" Click="Logout_Click"/>
                </StackPanel>
            </DockPanel>
        </Border>
        <Grid Grid.Row="1" Margin="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>
            <Border Background="#131C27" CornerRadius="10" Padding="14" Margin="0 0 12 0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Status" FontWeight="Bold" Foreground="#F0F6FC" Margin="0 0 8 0"/>
                        <TextBlock Text="Selected Category:" Foreground="#8BA1B9"/>
                        <TextBlock Text="{Binding SelectedCategoryName}" FontWeight="Bold" Foreground="#F0F6FC" TextWrapping="Wrap"/>
                        <Separator Margin="0 10 0 10"/>
                        <TextBlock Text="Selected Channel:" Foreground="#8BA1B9"/>
                        <TextBlock Text="{Binding SelectedChannelName}" FontWeight="Bold" Foreground="#F0F6FC" TextWrapping="Wrap"/>
                        <TextBlock Text="{Binding NowProgramText}" Foreground="#9DB2C7" FontSize="12" TextWrapping="Wrap"/>
                        <TextBlock Text="{Binding SelectedChannel.NowTitle}" Foreground="#DDE6F2" FontWeight="Bold" Margin="0 10 0 2" TextWrapping="Wrap"/>
                        <TextBlock Text="Description:" Margin="0 8 0 2" Foreground="#8BA1B9"/>
                        <TextBlock Text="{Binding SelectedChannel.NowDescription}" Foreground="#9DB2C7" FontSize="12" TextWrapping="Wrap" />
                        <!-- Upcoming programs -->
                        <Separator Margin="0 10 0 8"/>
                        <TextBlock Text="Upcoming:" FontWeight="Bold" Foreground="#F0F6FC"/>
                        <ItemsControl ItemsSource="{Binding UpcomingEntries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0 6 0 6">
                                        <TextBlock Text="{Binding Title}" Foreground="#DDE6F2" FontSize="12" TextWrapping="Wrap"/>
                                        <TextBlock Text="{Binding TimeRangeLocal}" Foreground="#8BA1B9" FontSize="10"/>
                                        <TextBlock Text="{Binding Description}" Foreground="#647A90" FontSize="10" TextWrapping="Wrap" Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Border>
            <Border Grid.Column="1" Background="#131C27" CornerRadius="10" >
                <TabControl x:Name="MainTabs" Background="#131C27" BorderThickness="0">
                    <TabItem Header="Categories">
                        <Border Background="#131C27">
                            <Grid Margin="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Categories" FontWeight="Bold" Foreground="#F0F6FC" FontSize="14"/>
                                    <TextBlock Margin="12 0 0 0" Foreground="#8BA1B9" Text="{Binding CategoriesCountText}"/>
                                </StackPanel>
                                <ScrollViewer Grid.Row="1" Margin="0 10 0 0" VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding Categories}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel IsItemsHost="True" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Click="CategoryTile_Click" Padding="0" Margin="6" Cursor="Hand" ToolTip="{Binding Name}">
                                                    <Border Width="150" Height="110" Background="#182433" CornerRadius="8" Padding="8" BorderBrush="#223247" BorderThickness="1">
                                                        <StackPanel>
                                                            <Border Height="50" Background="#223247" CornerRadius="4">
                                                                <Grid>
                                                                    <Image Source="{Binding ImageUrl}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    <TextBlock Text="No Image" Foreground="#4B5E71" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding ImageUrl, Converter={StaticResource NullToVisibilityConverter}}"/>
                                                                </Grid>
                                                            </Border>
                                                            <TextBlock Text="{Binding Name}" FontSize="12" Foreground="#DDE6F2" TextWrapping="Wrap" Margin="0 6 0 0"/>
                                                        </StackPanel>
                                                    </Border>
                                                </Button>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Border>
                    </TabItem>
                    <TabItem Header="Guide">
                        <Border Background="#131C27">
                            <Grid Margin="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Channels" FontWeight="Bold" Foreground="#F0F6FC" FontSize="14"/>
                                    <TextBlock Margin="12 0 0 0" Foreground="#8BA1B9" Text="{Binding Channels.Count, StringFormat={}{0} channels}"/>
                                </StackPanel>
                                <Grid Grid.Row="1" Margin="0 10 0 0">
                                    <Grid x:Name="GuideLoadingPanel" Background="#131C27">
                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Width="180">
                                            <ProgressBar IsIndeterminate="True" Height="10" Margin="0 0 0 12" />
                                            <TextBlock Text="Loading channels..." Foreground="#8BA1B9" FontStyle="Italic" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                    <ScrollViewer x:Name="GuideScroll" VerticalScrollBarVisibility="Auto" Visibility="Collapsed">
                                        <ItemsControl ItemsSource="{Binding Channels}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel IsItemsHost="True" />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Button Padding="0" Margin="6" Cursor="Hand" PreviewMouseLeftButtonDown="ChannelTile_PreviewMouseLeftButtonDown" MouseEnter="ChannelTile_MouseEnter" ToolTipService.ShowDuration="30000" ToolTip="{Binding TooltipText}">
                                                        <Border Width="160" Height="130" Background="#182433" CornerRadius="8" Padding="8" BorderBrush="#223247" BorderThickness="1">
                                                            <StackPanel>
                                                                <Border Height="55" Background="#223247" CornerRadius="4">
                                                                    <Grid>
                                                                        <Image x:Name="LogoImg" Source="{Binding LogoImage}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Visible"/>
                                                                        <TextBlock x:Name="LogoPlaceholder" Text="Loading..." Foreground="#4B5E71" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed"/>
                                                                    </Grid>
                                                                </Border>
                                                                <TextBlock Text="{Binding Name}" FontSize="12" Foreground="#DDE6F2" TextWrapping="Wrap" Margin="0 6 0 2"/>
                                                                <TextBlock Text="{Binding NowTitle}" FontSize="11" Foreground="#9DB2C7" TextWrapping="Wrap"/>
                                                                <TextBlock Text="{Binding NowTimeRange}" FontSize="10" Foreground="#8BA1B9"/>
                                                            </StackPanel>
                                                        </Border>
                                                    </Button>
                                                    <DataTemplate.Triggers>
                                                        <DataTrigger Binding="{Binding LogoImage}" Value="{x:Null}">
                                                            <Setter TargetName="LogoImg" Property="Visibility" Value="Collapsed" />
                                                            <Setter TargetName="LogoPlaceholder" Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </DataTemplate.Triggers>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </Grid>
                            </Grid>
                        </Border>
                    </TabItem>
                    <TabItem Header="Raw Output">
                        <Border Background="#131C27">
                            <Grid Margin="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="Output" FontWeight="Bold" Foreground="#F0F6FC"/>
                                <TextBox x:Name="OutputText" Grid.Row="1" Margin="0 8 0 0" FontFamily="Consolas" FontSize="12" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Background="#0E1620" Foreground="#C8D3E0"/>
                            </Grid>
                        </Border>
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>
    </Grid>
</Window>