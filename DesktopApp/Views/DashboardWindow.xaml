<Window x:Class="DesktopApp.Views.DashboardWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="IPTV Dashboard" Height="600" Width="1200" Background="#0D1117" WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <!-- Base header button style -->
        <Style x:Key="HeaderButtonBaseStyle" TargetType="Button">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="12 4"/>
            <Setter Property="Margin" Value="0 0 8 0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="#223247"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="#DDE6F2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#223247"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#2E425A"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" TargetName="Bd" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!-- Primary accent header button -->
        <Style x:Key="PrimaryHeaderButtonStyle" TargetType="Button" BasedOn="{StaticResource HeaderButtonBaseStyle}">
            <Setter Property="Background" Value="#347DFF"/>
            <Setter Property="BorderBrush" Value="#347DFF"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#4C8FFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#1F66E8"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" TargetName="Bd" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!-- Destructive / logout style -->
        <Style x:Key="DangerHeaderButtonStyle" TargetType="Button" BasedOn="{StaticResource HeaderButtonBaseStyle}">
            <Setter Property="Foreground" Value="#F8D7DA"/>
            <Setter Property="BorderBrush" Value="#5A1F28"/>
            <Setter Property="Background" Value="#3B1A20"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#742C38"/>
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#742C38"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#5A1F28"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" TargetName="Bd" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <Border Background="#131C27" Grid.Row="0" Padding="14 0" >
            <DockPanel>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="IPTV Dashboard" FontSize="18" FontWeight="Bold" Foreground="#F0F6FC"/>
                    <TextBlock Text="  -  Last EPG:" Foreground="#8BA1B9" Margin="14 0 4 0"/>
                    <TextBlock Text="{Binding LastEpgUpdateText}" Foreground="#DDE6F2"/>
                    <!-- Top navigation buttons -->
                    <StackPanel Orientation="Horizontal" Margin="40 0 0 0" VerticalAlignment="Center">
                        <Button x:Name="NavCategoriesBtn" Content="Categories" Click="NavCategories_Click" Margin="0 0 8 0" Padding="12 4" Background="Transparent" Foreground="#DDE6F2" BorderBrush="#223247" BorderThickness="1"/>
                        <Button x:Name="NavGuideBtn" Content="Guide" Click="NavGuide_Click" Margin="0 0 8 0" Padding="12 4" Background="Transparent" Foreground="#DDE6F2" BorderBrush="#223247" BorderThickness="1"/>
                        <Button x:Name="NavVodBtn" Content="VOD" Click="NavVod_Click" Margin="0 0 8 0" Padding="12 4" Background="Transparent" Foreground="#DDE6F2" BorderBrush="#223247" BorderThickness="1"/>
                        <Button x:Name="NavProfileBtn" Content="Profile" Click="NavProfile_Click" Margin="0 0 8 0" Padding="12 4" Background="Transparent" Foreground="#DDE6F2" BorderBrush="#223247" BorderThickness="1"/>
                        <Button x:Name="NavOutputBtn" Content="Raw Output" Click="NavOutput_Click" Margin="0 0 8 0" Padding="12 4" Background="Transparent" Foreground="#DDE6F2" BorderBrush="#223247" BorderThickness="1"/>
                    </StackPanel>
                </StackPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button x:Name="RecordStatusBtn" Style="{StaticResource HeaderButtonBaseStyle}" Margin="0 0 8 0" ToolTip="Show Recording Status" Click="OpenRecordingStatus_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE768;" Margin="0 0 6 0"/>
                            <TextBlock Text="Status"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="RecordBtn" Style="{StaticResource PrimaryHeaderButtonStyle}" Margin="0 0 12 0" ToolTip="Start/Stop Recording" Click="RecordBtn_Click">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="10" Height="10" Fill="#FF4136" VerticalAlignment="Center" Margin="0 0 6 0"/>
                            <TextBlock x:Name="RecordBtnText" Text="Record"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Text="User:" Foreground="#8BA1B9" Margin="0 0 10 0"/>
                    <TextBlock x:Name="UserNameText" Foreground="#DDE6F2" FontWeight="SemiBold" Margin="0 0 20 0"/>
                    <Button Style="{StaticResource PrimaryHeaderButtonStyle}" Click="OpenSettings_Click" ToolTip="Open settings" Margin="0 0 8 0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE713;" Margin="0 0 6 0"/>
                            <TextBlock Text="Settings"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource DangerHeaderButtonStyle}" Click="Logout_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8AC;" Margin="0 0 6 0"/>
                            <TextBlock Text="Logout"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </DockPanel>
        </Border>
        <Grid Grid.Row="1" Margin="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>
            <Border Background="#131C27" CornerRadius="10" Padding="14" Margin="0 0 12 0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Moved Search Area with added spacing -->
                        <TextBlock Text="Search" FontWeight="Bold" Foreground="#F0F6FC" Margin="0 0 8 0"/>
                        <Border Background="#182433" CornerRadius="6" BorderBrush="#223247" BorderThickness="1" Padding="8" Margin="0 0 16 12">
                            <StackPanel>
                                <TextBox x:Name="SearchTextBox" Margin="0 6 0 4" BorderThickness="0" Background="#0E1620" Foreground="#DDE6F2" Padding="6 4" Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" ToolTip="Search categories or channels"/>
                                <TextBlock Text="Type to search..." Foreground="#5A6B7F" Margin="6 -30 0 0" IsHitTestVisible="False" VerticalAlignment="Center" Visibility="{Binding Text, ElementName=SearchTextBox, Converter={StaticResource NullToVisibilityConverter}}"/>
                                <CheckBox Content="Search All Channels" Margin="0 8 0 0" VerticalAlignment="Center" Foreground="#DDE6F2" IsChecked="{Binding SearchAllChannels}" ToolTip="Search across all channels"/>
                            </StackPanel>
                        </Border>
                        <Separator Margin="0 0 0 12"/>
                        <TextBlock Text="Status" FontWeight="Bold" Foreground="#F0F6FC" Margin="0 0 8 0"/>
                        <TextBlock Text="Selected Category:" Foreground="#8BA1B9"/>
                        <TextBlock Text="{Binding SelectedCategoryName}" FontWeight="Bold" Foreground="#F0F6FC" TextWrapping="Wrap"/>
                        <Separator Margin="0 10 0 10"/>
                        <TextBlock Text="Selected Channel:" Foreground="#8BA1B9"/>
                        <TextBlock Text="{Binding SelectedChannelName}" FontWeight="Bold" Foreground="#F0F6FC" TextWrapping="Wrap"/>
                        <TextBlock Text="{Binding NowProgramText}" Foreground="#9DB2C7" FontSize="12" TextWrapping="Wrap"/>
                        <TextBlock Text="{Binding SelectedChannel.NowTitle}" Foreground="#DDE6F2" FontWeight="Bold" Margin="0 10 0 2" TextWrapping="Wrap"/>
                        <TextBlock Text="Description:" Margin="0 8 0 2" Foreground="#8BA1B9"/>
                        <TextBlock Text="{Binding SelectedChannel.NowDescription}" Foreground="#9DB2C7" FontSize="12" TextWrapping="Wrap" />
                        <Separator Margin="0 10 0 8"/>
                        <TextBlock Text="Upcoming:" FontWeight="Bold" Foreground="#F0F6FC"/>
                        <ItemsControl ItemsSource="{Binding UpcomingEntries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0 6 0 6">
                                        <TextBlock Text="{Binding Title}" Foreground="#DDE6F2" FontSize="12" TextWrapping="Wrap"/>
                                        <TextBlock Text="{Binding TimeRangeLocal}" Foreground="#8BA1B9" FontSize="10"/>
                                        <TextBlock Text="{Binding Description}" Foreground="#647A90" FontSize="10" TextWrapping="Wrap" Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Border>
            <Border Grid.Column="1" Background="#131C27" CornerRadius="10" >
                <!-- Overlaid views; full width since nav moved to header -->
                <Grid>
                    <!-- Categories View -->
                    <Grid x:Name="CategoriesGrid" Visibility="Visible">
                        <Grid Margin="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Categories" FontWeight="Bold" Foreground="#F0F6FC" FontSize="14"/>
                                <TextBlock Margin="12 0 0 0" Foreground="#8BA1B9" Text="{Binding CategoriesCountText}"/>
                            </StackPanel>
                            <ScrollViewer Grid.Row="1" Margin="0 10 0 0" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding CategoriesCollectionView}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel IsItemsHost="True" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Click="CategoryTile_Click" Padding="0" Margin="6" Cursor="Hand" ToolTip="{Binding Name}">
                                                <Border Width="150" Height="110" Background="#182433" CornerRadius="8" Padding="8" BorderBrush="#223247" BorderThickness="1">
                                                    <StackPanel>
                                                        <Border Height="50" Background="#223247" CornerRadius="4">
                                                            <Grid>
                                                                <Image Source="{Binding ImageUrl}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                <TextBlock Text="No Image" Foreground="#4B5E71" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding ImageUrl, Converter={StaticResource NullToVisibilityConverter}}"/>
                                                            </Grid>
                                                        </Border>
                                                        <TextBlock Text="{Binding Name}" FontSize="12" Foreground="#DDE6F2" TextWrapping="Wrap" Margin="0 6 0 0"/>
                                                    </StackPanel>
                                                </Border>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                    <!-- Guide View -->
                    <Grid x:Name="GuideView" Visibility="Collapsed">
                        <Grid Margin="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Channels" FontWeight="Bold" Foreground="#F0F6FC" FontSize="14"/>
                                <TextBlock Margin="12 0 0 0" Foreground="#8BA1B9" Text="{Binding ChannelsCountText}"/>
                            </StackPanel>
                            <Grid Grid.Row="1" Margin="0 10 0 0">
                                <Grid x:Name="GuideLoadingPanel" Background="#131C27">
                                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Width="180">
                                        <ProgressBar IsIndeterminate="True" Height="10" Margin="0 0 0 12" />
                                        <TextBlock Text="Loading channels..." Foreground="#8BA1B9" FontStyle="Italic" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>
                                <ScrollViewer x:Name="GuideScroll" VerticalScrollBarVisibility="Auto" Visibility="Collapsed">
                                    <ItemsControl ItemsSource="{Binding ChannelsCollectionView}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel IsItemsHost="True" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Padding="0" Margin="6" Cursor="Hand" PreviewMouseLeftButtonDown="ChannelTile_PreviewMouseLeftButtonDown" MouseEnter="ChannelTile_MouseEnter" ToolTipService.ShowDuration="30000" ToolTip="{Binding TooltipText}">
                                                    <Border Width="160" Height="130" Background="#182433" CornerRadius="8" Padding="8" BorderBrush="#223247" BorderThickness="1">
                                                        <StackPanel>
                                                            <Border Height="55" Background="#223247" CornerRadius="4">
                                                                <Grid>
                                                                    <Image x:Name="LogoImg" Source="{Binding LogoImage}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Visible"/>
                                                                    <TextBlock x:Name="LogoPlaceholder" Text="Loading..." Foreground="#4B5E71" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed"/>
                                                                </Grid>
                                                            </Border>
                                                            <TextBlock Text="{Binding Name}" FontSize="12" Foreground="#DDE6F2" TextWrapping="Wrap" Margin="0 6 0 2"/>
                                                            <TextBlock Text="{Binding NowTitle}" FontSize="11" Foreground="#9DB2C7" TextWrapping="Wrap"/>
                                                            <TextBlock Text="{Binding NowTimeRange}" FontSize="10" Foreground="#8BA1B9"/>
                                                        </StackPanel>
                                                    </Border>
                                                </Button>
                                                <DataTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding LogoImage}" Value="{x:Null}">
                                                        <Setter TargetName="LogoImg" Property="Visibility" Value="Collapsed" />
                                                        <Setter TargetName="LogoPlaceholder" Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </DataTemplate.Triggers>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Grid>
                    </Grid>
                    <!-- Profile View -->
                    <Grid x:Name="ProfileView" Visibility="Collapsed">
                        <ScrollViewer Margin="12" VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock Text="Profile" FontWeight="Bold" Foreground="#F0F6FC" FontSize="14" Margin="0 0 0 8"/>
                                <TextBlock Text="Below is information returned by the service for your account." Foreground="#8BA1B9" FontSize="12" TextWrapping="Wrap" Margin="0 0 0 12"/>
                                <Grid Margin="0 0 0 12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="Username:" Foreground="#8BA1B9" Grid.Row="0"/>
                                    <TextBlock Text="{Binding ProfileUsername}" Foreground="#DDE6F2" Grid.Row="0" Grid.Column="1"/>
                                    <TextBlock Text="Status:" Foreground="#8BA1B9" Grid.Row="1"/>
                                    <TextBlock Text="{Binding ProfileStatus}" Foreground="#DDE6F2" Grid.Row="1" Grid.Column="1"/>
                                    <TextBlock Text="Trial:" Foreground="#8BA1B9" Grid.Row="2"/>
                                    <TextBlock Text="{Binding ProfileTrialText}" Foreground="#DDE6F2" Grid.Row="2" Grid.Column="1"/>
                                    <TextBlock Text="Expires:" Foreground="#8BA1B9" Grid.Row="3"/>
                                    <TextBlock Text="{Binding ProfileExpiryText}" Foreground="#DDE6F2" Grid.Row="3" Grid.Column="1"/>
                                    <TextBlock Text="Days Remaining:" Foreground="#8BA1B9" Grid.Row="4"/>
                                    <TextBlock Text="{Binding ProfileDaysRemaining}" Foreground="#DDE6F2" Grid.Row="4" Grid.Column="1"/>
                                    <TextBlock Text="Max Connections:" Foreground="#8BA1B9" Grid.Row="5"/>
                                    <TextBlock Text="{Binding ProfileMaxConnections}" Foreground="#DDE6F2" Grid.Row="5" Grid.Column="1"/>
                                    <TextBlock Text="Active Connections:" Foreground="#8BA1B9" Grid.Row="6"/>
                                    <TextBlock Text="{Binding ProfileActiveConnections}" Foreground="#DDE6F2" Grid.Row="6" Grid.Column="1"/>
                                </Grid>
                                <TextBlock Text="Raw JSON user_info (for debugging):" Foreground="#8BA1B9" Margin="0 0 0 4"/>
                                <TextBox Text="{Binding ProfileRawJson}" IsReadOnly="True" FontFamily="Consolas" FontSize="11" TextWrapping="Wrap" AcceptsReturn="True" Height="160" VerticalScrollBarVisibility="Auto" Background="#0E1620" Foreground="#C8D3E0"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                    <!-- VOD View -->
                    <Grid x:Name="VodView" Visibility="Collapsed">
                        <Grid Margin="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Video on Demand" FontWeight="Bold" Foreground="#F0F6FC" FontSize="14"/>
                                <TextBlock Margin="12 0 0 0" Foreground="#8BA1B9" Text="{Binding VodCountText}"/>
                            </StackPanel>
                            <!-- VOD Category Selection -->
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0 10 0 0" VerticalAlignment="Center">
                                <TextBlock Text="Category:" Foreground="#8BA1B9" VerticalAlignment="Center" Margin="0 0 8 0"/>
                                <ComboBox x:Name="VodCategoryCombo" Width="200" Height="32" Background="#182433" Foreground="#DDE6F2" BorderBrush="#223247"
                                          ItemsSource="{Binding VodCategories}" DisplayMemberPath="CategoryName" SelectedValuePath="CategoryId"
                                          SelectedValue="{Binding SelectedVodCategoryId}" SelectionChanged="VodCategory_SelectionChanged">
                                    <ComboBox.Template>
                                        <ControlTemplate TargetType="ComboBox">
                                            <Grid>
                                                <ToggleButton Name="ToggleButton" Grid.Column="2" Focusable="false" IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" ClickMode="Press">
                                                    <ToggleButton.Template>
                                                        <ControlTemplate TargetType="ToggleButton">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition />
                                                                    <ColumnDefinition Width="32" />
                                                                </Grid.ColumnDefinitions>
                                                                <Border x:Name="Border" Grid.ColumnSpan="2" CornerRadius="4" Background="#182433" BorderBrush="#223247" BorderThickness="1" />
                                                                <Path x:Name="Arrow" Grid.Column="1" Fill="#DDE6F2" HorizontalAlignment="Center" VerticalAlignment="Center" Data="M 0 0 L 4 4 L 8 0 Z"/>
                                                            </Grid>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="true">
                                                                    <Setter TargetName="Border" Property="Background" Value="#223247"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </ToggleButton.Template>
                                                </ToggleButton>
                                                <ContentPresenter Name="ContentSite" IsHitTestVisible="False" Content="{TemplateBinding SelectionBoxItem}" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" Margin="8,4" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                                <Popup Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                                                    <Grid Name="DropDown" SnapsToDevicePixels="True" MinWidth="{TemplateBinding ActualWidth}" MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                                        <Border x:Name="DropDownBorder" Background="#182433" BorderThickness="1" BorderBrush="#223247"/>
                                                        <ScrollViewer Margin="4,6" SnapsToDevicePixels="True">
                                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                                        </ScrollViewer>
                                                    </Grid>
                                                </Popup>
                                            </Grid>
                                        </ControlTemplate>
                                    </ComboBox.Template>
                                    <ComboBox.Resources>
                                        <Style TargetType="ComboBoxItem">
                                            <Setter Property="Background" Value="#182433"/>
                                            <Setter Property="Foreground" Value="#DDE6F2"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ComboBoxItem">
                                                        <Border Name="Border" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter />
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsHighlighted" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="#223247"/>
                                                            </Trigger>
                                                            <Trigger Property="IsSelected" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="#2E425A"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ComboBox.Resources>
                                </ComboBox>
                            </StackPanel>
                            <ScrollViewer Grid.Row="2" Margin="0 10 0 0" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding VodContentCollectionView}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel IsItemsHost="True" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Click="VodContent_Click" Padding="0" Margin="6" Cursor="Hand" ToolTip="{Binding Plot}">
                                                <Border Width="180" Height="250" Background="#182433" CornerRadius="8" Padding="8" BorderBrush="#223247" BorderThickness="1">
                                                    <StackPanel>
                                                        <Border Height="140" Background="#223247" CornerRadius="4">
                                                            <Grid>
                                                                <Image Source="{Binding PosterImage}" Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                <TextBlock Text="No Poster" Foreground="#4B5E71" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding PosterImage, Converter={StaticResource NullToVisibilityConverter}}"/>
                                                            </Grid>
                                                        </Border>
                                                        <TextBlock Text="{Binding DisplayTitle}" FontSize="12" FontWeight="Bold" Foreground="#DDE6F2" TextWrapping="Wrap" Margin="0 6 0 2" MaxHeight="32"/>
                                                        <TextBlock Text="{Binding DisplayGenre}" FontSize="10" Foreground="#9DB2C7" TextWrapping="Wrap" Margin="0 2 0 2"/>
                                                        <StackPanel Orientation="Horizontal" Margin="0 2 0 0">
                                                            <TextBlock Text="{Binding DisplayYear}" FontSize="10" Foreground="#8BA1B9" Margin="0 0 8 0"/>
                                                            <TextBlock Text="{Binding DisplayDuration}" FontSize="10" Foreground="#8BA1B9" Margin="0 0 8 0"/>
                                                            <TextBlock Text="{Binding DisplayRating}" FontSize="10" Foreground="#8BA1B9"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </Border>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                    <!-- Raw Output View -->
                    <Grid x:Name="OutputView" Visibility="Collapsed">
                        <Grid Margin="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="Output" FontWeight="Bold" Foreground="#F0F6FC"/>
                            <TextBox x:Name="OutputText" Grid.Row="1" Margin="0 8 0 0" FontFamily="Consolas" FontSize="12" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Background="#0E1620" Foreground="#C8D3E0"/>
                        </Grid>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>