<Window x:Class="DesktopApp.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings" Height="520" Width="620"
        WindowStartupLocation="CenterOwner" Background="#0D1117">

	<Window.Resources>
		<!-- TextBox style -->
		<Style TargetType="TextBox" x:Key="InputTextBox">
			<Setter Property="Margin" Value="0 4 0 14"/>
			<Setter Property="Padding" Value="10 6"/>
			<Setter Property="Foreground" Value="#FFFFFF"/>
			<Setter Property="Background" Value="#182230"/>
			<Setter Property="BorderBrush" Value="#243347"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="SnapsToDevicePixels" Value="True"/>
			<Setter Property="CaretBrush" Value="#FFFFFF"/>
			<Setter Property="SelectionBrush" Value="#264066"/>
			<Setter Property="SelectionOpacity" Value="0.55"/>
		</Style>

		<!-- ComboBox custom template ensuring visible selected text -->
		<Style TargetType="ComboBox" x:Key="ComboStyle">
			<Setter Property="Foreground" Value="#E6ECF3"/>
			<Setter Property="Background" Value="#1E2937"/>
			<Setter Property="BorderBrush" Value="#243347"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="4 2"/>
			<Setter Property="HorizontalContentAlignment" Value="Left"/>
			<Setter Property="SnapsToDevicePixels" Value="True"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ComboBox">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition/>
								<ColumnDefinition Width="28"/>
							</Grid.ColumnDefinitions>
							<Border x:Name="Bd" Grid.ColumnSpan="2" CornerRadius="6" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"/>
							<ContentPresenter x:Name="ContentSite"
								Margin="8,2,4,2"
								HorizontalAlignment="Left"
								VerticalAlignment="Center"
								RecognizesAccessKey="True"
								ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
								ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
								Content="{TemplateBinding SelectionBoxItem}"/>
							<ToggleButton Grid.ColumnSpan="2"
								Background="Transparent"
								BorderBrush="Transparent"
								Focusable="False"
								IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
								ClickMode="Press">
								<ContentControl Focusable="False">
									<Grid>
										<Path Data="M 0 0 L 6 6 L 12 0 Z" Fill="#9DB1C5" Stretch="Uniform" Width="12" Height="6" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0 0 6 0"/>
									</Grid>
								</ContentControl>
								<ToggleButton.Template>
									<ControlTemplate TargetType="ToggleButton">
										<Border Background="Transparent"/>
									</ControlTemplate>
								</ToggleButton.Template>
							</ToggleButton>
							<Popup x:Name="PART_Popup"
								Placement="Bottom"
								IsOpen="{TemplateBinding IsDropDownOpen}"
								AllowsTransparency="True"
								Focusable="False"
								PopupAnimation="Fade">
								<Border CornerRadius="6" Background="#1E2937" BorderBrush="#243347" BorderThickness="1">
									<ScrollViewer Margin="0" MaxHeight="260" CanContentScroll="True">
										<ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
									</ScrollViewer>
								</Border>
							</Popup>
						</Grid>
						<ControlTemplate.Triggers>
							<Trigger Property="HasItems" Value="False">
								<Setter TargetName="ContentSite" Property="MinHeight" Value="22"/>
							</Trigger>
							<Trigger Property="IsEnabled" Value="False">
								<Setter TargetName="Bd" Property="Opacity" Value="0.45"/>
							</Trigger>
							<Trigger Property="IsKeyboardFocusWithin" Value="True">
								<Setter TargetName="Bd" Property="BorderBrush" Value="#335078"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- Drop-down items -->
		<Style TargetType="ComboBoxItem" x:Key="PlayerComboItemStyle">
			<Setter Property="Foreground" Value="#E0E7EF"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Padding" Value="10 6"/>
			<Setter Property="HorizontalContentAlignment" Value="Left"/>
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="True">
					<Setter Property="Background" Value="#253346"/>
				</Trigger>
				<Trigger Property="IsSelected" Value="True">
					<Setter Property="Background" Value="#335078"/>
					<Setter Property="Foreground" Value="#FFFFFF"/>
				</Trigger>
			</Style.Triggers>
		</Style>

		<!-- Primary button -->
		<Style TargetType="Button" x:Key="PrimaryButton">
			<Setter Property="Background" Value="#3D6EFF"/>
			<Setter Property="Foreground" Value="#FFFFFF"/>
			<Setter Property="Padding" Value="14 8"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border x:Name="bd" CornerRadius="8" Background="{TemplateBinding Background}">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="bd" Property="Background" Value="#5A82FF"/>
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter TargetName="bd" Property="Background" Value="#2F57B8"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
	</Window.Resources>

	<Grid Margin="18">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0 0 0 12" VerticalAlignment="Center">
			<TextBlock Text="Application Settings" FontSize="24" FontWeight="Bold" Foreground="#FFFFFF"/>
		</StackPanel>

		<ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
			<StackPanel>

				<!-- Label -->
				<TextBlock Text="External Player" Foreground="#8BA1B9" FontSize="12" Margin="2 0 0 0"/>

				<ComboBox x:Name="PlayerKindCombo"
						  Style="{StaticResource ComboStyle}"
						  ItemContainerStyle="{StaticResource PlayerComboItemStyle}"
						  SelectedIndex="0"
						  SelectionChanged="PlayerKindCombo_SelectionChanged">
					<ComboBoxItem Tag="VLC"   Content="VLC"/>
					<ComboBoxItem Tag="MPCHC" Content="MPC-HC"/>
					<ComboBoxItem Tag="MPV"   Content="mpv"/>
					<ComboBoxItem Tag="Custom" Content="Custom"/>
				</ComboBox>

				<TextBlock Text="Player Executable Path" Foreground="#8BA1B9" FontSize="12" Margin="2 4 0 0"/>
				<DockPanel>
					<TextBox x:Name="PlayerExeTextBox" Style="{StaticResource InputTextBox}" Margin="0 4 8 14"/>
					<Button Content="Browse" Width="110" Height="34" Margin="0 4 0 14" Click="BrowsePlayer_Click"/>
				</DockPanel>

				<TextBlock Text="Arguments Template" Foreground="#8BA1B9" FontSize="12" Margin="2 4 0 0"/>
				<TextBox x:Name="ArgsTemplateTextBox" Style="{StaticResource InputTextBox}"/>

				<TextBlock Text="Tokens: {url} {title}. Leave blank to use default for selected player. For custom player specify both path and suitable arguments."
                           Foreground="#657A91" FontSize="11" TextWrapping="Wrap" Margin="0 0 0 8"/>

                <!-- EPG Section -->
                <Separator Margin="0 10 0 10"/>
                <TextBlock Text="EPG Settings" Foreground="#8BA1B9" FontSize="14" FontWeight="SemiBold"/>
                <TextBlock Text="Last EPG Update" Foreground="#8BA1B9" FontSize="12" Margin="2 10 0 0"/>
                <TextBox x:Name="LastEpgUpdateTextBox" Style="{StaticResource InputTextBox}" IsReadOnly="True"/>
                <TextBlock Text="EPG Refresh Interval (minutes)" Foreground="#8BA1B9" FontSize="12" Margin="2 4 0 0"/>
                <TextBox x:Name="EpgIntervalTextBox" Style="{StaticResource InputTextBox}"/>
                <DockPanel LastChildFill="False" Margin="0 0 0 10">
                    <Button Content="Update EPG Now" Width="150" Height="36" Click="UpdateEpgNow_Click"/>
                </DockPanel>
			</StackPanel>
		</ScrollViewer>

		<StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
			<Button Content="Save" Width="110" Height="40" Margin="0 0 10 0"
                    Style="{StaticResource PrimaryButton}" Click="Save_Click"/>
			<Button Content="Close" Width="90" Height="40" Click="Close_Click"/>
		</StackPanel>
	</Grid>
</Window>
