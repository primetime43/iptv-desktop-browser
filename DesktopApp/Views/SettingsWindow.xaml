<Window x:Class="DesktopApp.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings" Height="700" Width="650"
        WindowStartupLocation="CenterOwner" Background="#0D1117" ResizeMode="CanResize" MinHeight="600" MinWidth="580">

	<Window.Resources>
		<!-- TextBox style -->
		<Style TargetType="TextBox" x:Key="InputTextBox">
			<Setter Property="Margin" Value="0 4 0 14"/>
			<Setter Property="Padding" Value="10 6"/>
			<Setter Property="Foreground" Value="#FFFFFF"/>
			<Setter Property="Background" Value="#182230"/>
			<Setter Property="BorderBrush" Value="#243347"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="SnapsToDevicePixels" Value="True"/>
			<Setter Property="CaretBrush" Value="#FFFFFF"/>
			<Setter Property="SelectionBrush" Value="#264066"/>
			<Setter Property="SelectionOpacity" Value="0.55"/>
		</Style>

		<!-- ComboBox custom template ensuring visible selected text -->
		<Style TargetType="ComboBox" x:Key="ComboStyle">
			<Setter Property="Foreground" Value="#E6ECF3"/>
			<Setter Property="Background" Value="#1E2937"/>
			<Setter Property="BorderBrush" Value="#243347"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="4 2"/>
			<Setter Property="HorizontalContentAlignment" Value="Left"/>
			<Setter Property="SnapsToDevicePixels" Value="True"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ComboBox">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition/>
								<ColumnDefinition Width="28"/>
							</Grid.ColumnDefinitions>
							<Border x:Name="Bd" Grid.ColumnSpan="2" CornerRadius="6" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"/>
							<ContentPresenter x:Name="ContentSite"
								Margin="8,2,4,2"
								HorizontalAlignment="Left"
								VerticalAlignment="Center"
								RecognizesAccessKey="True"
								ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
								ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
								Content="{TemplateBinding SelectionBoxItem}"/>
							<ToggleButton Grid.ColumnSpan="2"
								Background="Transparent"
								BorderBrush="Transparent"
								Focusable="False"
								IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
								ClickMode="Press">
								<ContentControl Focusable="False">
									<Grid>
										<Path Data="M 0 0 L 6 6 L 12 0 Z" Fill="#9DB1C5" Stretch="Uniform" Width="12" Height="6" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0 0 6 0"/>
									</Grid>
								</ContentControl>
								<ToggleButton.Template>
									<ControlTemplate TargetType="ToggleButton">
										<Border Background="Transparent"/>
									</ControlTemplate>
								</ToggleButton.Template>
							</ToggleButton>
							<Popup x:Name="PART_Popup"
								Placement="Bottom"
								IsOpen="{TemplateBinding IsDropDownOpen}"
								AllowsTransparency="True"
								Focusable="False"
								PopupAnimation="Fade">
								<Border CornerRadius="6" Background="#1E2937" BorderBrush="#243347" BorderThickness="1">
									<ScrollViewer Margin="0" MaxHeight="260" CanContentScroll="True">
										<ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
									</ScrollViewer>
								</Border>
							</Popup>
						</Grid>
						<ControlTemplate.Triggers>
							<Trigger Property="HasItems" Value="False">
								<Setter TargetName="ContentSite" Property="MinHeight" Value="22"/>
							</Trigger>
							<Trigger Property="IsEnabled" Value="False">
								<Setter TargetName="Bd" Property="Opacity" Value="0.45"/>
							</Trigger>
							<Trigger Property="IsKeyboardFocusWithin" Value="True">
								<Setter TargetName="Bd" Property="BorderBrush" Value="#335078"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- Drop-down items -->
		<Style TargetType="ComboBoxItem" x:Key="PlayerComboItemStyle">
			<Setter Property="Foreground" Value="#E0E7EF"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Padding" Value="10 6"/>
			<Setter Property="HorizontalContentAlignment" Value="Left"/>
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="True">
					<Setter Property="Background" Value="#253346"/>
				</Trigger>
				<Trigger Property="IsSelected" Value="True">
					<Setter Property="Background" Value="#335078"/>
					<Setter Property="Foreground" Value="#FFFFFF"/>
				</Trigger>
			</Style.Triggers>
		</Style>

		<!-- Primary button -->
		<Style TargetType="Button" x:Key="PrimaryButton">
			<Setter Property="Background" Value="#3D6EFF"/>
			<Setter Property="Foreground" Value="#FFFFFF"/>
			<Setter Property="Padding" Value="14 8"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border x:Name="bd" CornerRadius="8" Background="{TemplateBinding Background}">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="bd" Property="Background" Value="#5A82FF"/>
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter TargetName="bd" Property="Background" Value="#2F57B8"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- Secondary button -->
		<Style TargetType="Button" x:Key="SecondaryButton">
			<Setter Property="Background" Value="#1E2A38"/>
			<Setter Property="Foreground" Value="#DDE6F2"/>
			<Setter Property="Padding" Value="12 6"/>
			<Setter Property="BorderBrush" Value="#324660"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border x:Name="bd" CornerRadius="6" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="bd" Property="Background" Value="#2A3947"/>
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter TargetName="bd" Property="Background" Value="#1A252F"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- Section header style -->
		<Style TargetType="TextBlock" x:Key="SectionHeader">
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="#F0F6FC"/>
			<Setter Property="Margin" Value="0 16 0 8"/>
		</Style>

		<!-- Status message style -->
		<Style TargetType="TextBlock" x:Key="StatusMessage">
			<Setter Property="FontSize" Value="11"/>
			<Setter Property="Margin" Value="2 4 0 0"/>
			<Setter Property="TextWrapping" Value="Wrap"/>
		</Style>
	</Window.Resources>

	<Grid Margin="18">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0 0 0 12" VerticalAlignment="Center">
			<TextBlock Text="Application Settings" FontSize="24" FontWeight="Bold" Foreground="#FFFFFF"/>
		</StackPanel>

		<ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
			<StackPanel>
				<!-- Status bar -->
				<Border Background="#1A242F" CornerRadius="6" Padding="12 8" Margin="0 0 0 8">
					<TextBlock x:Name="StatusText" Text="Configure your IPTV player and recording settings"
							   Foreground="#8BA1B9" FontSize="12"/>
				</Border>

				<!-- Player Settings Section -->
				<TextBlock Text="ðŸŽ¬ Player Settings" Style="{StaticResource SectionHeader}"/>
				<Border Background="#161B22" CornerRadius="8" Padding="16" Margin="0 0 0 8">
					<StackPanel>
						<TextBlock Text="External Player" Foreground="#8BA1B9" FontSize="12" Margin="2 0 0 0"/>
						<ComboBox x:Name="PlayerKindCombo"
								  Style="{StaticResource ComboStyle}"
								  ItemContainerStyle="{StaticResource PlayerComboItemStyle}"
								  SelectedIndex="0"
								  SelectionChanged="PlayerKindCombo_SelectionChanged">
							<ComboBoxItem Tag="VLC"   Content="VLC Media Player"/>
							<ComboBoxItem Tag="MPCHC" Content="MPC-HC"/>
							<ComboBoxItem Tag="MPV"   Content="mpv"/>
							<ComboBoxItem Tag="Custom" Content="Custom Player"/>
						</ComboBox>

						<TextBlock Text="Player Executable Path" Foreground="#8BA1B9" FontSize="12" Margin="2 8 0 0"/>
						<TextBox x:Name="PlayerExeTextBox" Style="{StaticResource InputTextBox}" Margin="0 4 0 0" Height="34" TextChanged="PlayerExeTextBox_TextChanged"/>
						<StackPanel Orientation="Horizontal" Margin="0 4 0 8">
							<Button Content="Browse" Width="110" Height="32" Margin="0 0 8 0" Click="BrowsePlayer_Click" Style="{StaticResource SecondaryButton}"/>
							<Button x:Name="AutoDetectPlayerBtn" Content="Auto-detect" Width="110" Height="32" Click="AutoDetectPlayer_Click" Style="{StaticResource SecondaryButton}" FontSize="11"/>
						</StackPanel>
						<TextBlock x:Name="PlayerPathStatus" Style="{StaticResource StatusMessage}" Foreground="#22863A"/>

						<TextBlock Text="Arguments Template" Foreground="#8BA1B9" FontSize="12" Margin="2 8 0 0"/>
						<TextBox x:Name="ArgsTemplateTextBox" Style="{StaticResource InputTextBox}" Height="34" TextChanged="ArgsTemplateTextBox_TextChanged"/>
						<TextBlock Text="Tokens: {url} {title}. Leave blank to use default for selected player."
								   Foreground="#657A91" FontSize="11" TextWrapping="Wrap" Margin="0 0 0 0"/>
						<StackPanel Orientation="Horizontal" Margin="0 4 0 0">
							<Button x:Name="TestPlayerBtn" Content="Test Player" Width="100" Height="28" Click="TestPlayer_Click" Style="{StaticResource SecondaryButton}" FontSize="11"/>
							<TextBlock x:Name="TestPlayerStatus" Style="{StaticResource StatusMessage}" Foreground="#8BA1B9" VerticalAlignment="Center" Margin="8 0 0 0"/>
						</StackPanel>
					</StackPanel>
				</Border>

				<!-- Recording Settings Section -->
				<TextBlock Text="ðŸŽ¥ Recording Settings" Style="{StaticResource SectionHeader}"/>
				<Border Background="#161B22" CornerRadius="8" Padding="16" Margin="0 0 0 8">
					<StackPanel>
						<TextBlock Text="FFmpeg Path" Foreground="#8BA1B9" FontSize="12" Margin="2 0 0 0"/>
						<TextBox x:Name="FfmpegPathTextBox" Style="{StaticResource InputTextBox}" Margin="0 4 0 0" Height="34" TextChanged="FfmpegPathTextBox_TextChanged"/>
						<StackPanel Orientation="Horizontal" Margin="0 4 0 8">
							<Button Content="Browse" Width="110" Height="32" Margin="0 0 8 0" Click="BrowseFfmpeg_Click" Style="{StaticResource SecondaryButton}"/>
							<Button x:Name="AutoDetectFfmpegBtn" Content="Auto-detect" Width="110" Height="32" Click="AutoDetectFfmpeg_Click" Style="{StaticResource SecondaryButton}" FontSize="11"/>
						</StackPanel>
						<TextBlock x:Name="FfmpegPathStatus" Style="{StaticResource StatusMessage}" Foreground="#22863A"/>

						<TextBlock Text="Recording Directory" Foreground="#8BA1B9" FontSize="12" Margin="2 8 0 0"/>
						<TextBox x:Name="RecordingDirTextBox" Style="{StaticResource InputTextBox}" Margin="0 4 0 0" Height="34" TextChanged="RecordingDirTextBox_TextChanged"/>
						<Button Content="Browse" Width="110" Height="32" Margin="0 4 0 8" Click="BrowseRecordingDir_Click" Style="{StaticResource SecondaryButton}"/>
						<TextBlock x:Name="RecordingDirStatus" Style="{StaticResource StatusMessage}" Foreground="#8BA1B9"/>

						<TextBlock Text="FFmpeg Args Template" Foreground="#8BA1B9" FontSize="12" Margin="2 8 0 0"/>
						<TextBox x:Name="FfmpegArgsTextBox" Style="{StaticResource InputTextBox}" Height="34"/>
						<TextBlock Text="Tokens: {url} {output} {title}. Default copies stream without re-encoding."
								   Foreground="#657A91" FontSize="11" TextWrapping="Wrap" Margin="0 0 0 0"/>
					</StackPanel>
				</Border>

				<!-- EPG Settings Section -->
				<TextBlock Text="ðŸ“º EPG Settings" Style="{StaticResource SectionHeader}"/>
				<Border Background="#161B22" CornerRadius="8" Padding="16" Margin="0 0 0 8">
					<StackPanel>
						<TextBlock Text="Last EPG Update" Foreground="#8BA1B9" FontSize="12" Margin="2 0 0 0"/>
						<TextBox x:Name="LastEpgUpdateTextBox" Style="{StaticResource InputTextBox}" Height="34" IsReadOnly="True"/>

						<TextBlock Text="EPG Refresh Interval (minutes)" Foreground="#8BA1B9" FontSize="12" Margin="2 8 0 0"/>
						<TextBox x:Name="EpgIntervalTextBox" Style="{StaticResource InputTextBox}" Margin="0 4 0 0" Height="34" TextChanged="EpgIntervalTextBox_TextChanged"/>
						<Button Content="Update EPG Now" Width="150" Height="32" Margin="0 4 0 8" Click="UpdateEpgNow_Click" Style="{StaticResource SecondaryButton}"/>
						<TextBlock x:Name="EpgIntervalStatus" Style="{StaticResource StatusMessage}" Foreground="#8BA1B9"/>
					</StackPanel>
				</Border>
			</StackPanel>
		</ScrollViewer>

		<Border Grid.Row="2" Background="#131C27" Padding="16 12" Margin="-18 8 -18 -18">
			<StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
				<Button Content="Restore Defaults" Width="140" Height="40" Margin="0 0 12 0" Click="RestoreDefaults_Click" Style="{StaticResource SecondaryButton}"/>
				<Button Content="Save Settings" Width="120" Height="40" Margin="0 0 8 0" Style="{StaticResource PrimaryButton}" Click="Save_Click"/>
				<Button Content="Cancel" Width="80" Height="40" Click="Close_Click" Style="{StaticResource SecondaryButton}"/>
			</StackPanel>
		</Border>
	</Grid>
</Window>
