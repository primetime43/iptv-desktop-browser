<Window x:Class="DesktopApp.Views.RecordingSchedulerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Recording Scheduler" Height="600" Width="800"
        Background="#FF1E2A3A" WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize" MinHeight="500" MinWidth="700">

    <Window.Resources>
        <!-- ComboBox Styling -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#FF2A3A4F"/>
            <Setter Property="Foreground" Value="#FFDDE6F2"/>
            <Setter Property="BorderBrush" Value="#FF3B4A5C"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border x:Name="Border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="3">
                                <Grid>
                                    <ToggleButton x:Name="ToggleButton"
                                                  Grid.Column="2"
                                                  Focusable="false"
                                                  IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                  ClickMode="Press"
                                                  Background="Transparent"
                                                  BorderThickness="0">
                                        <Path x:Name="Arrow"
                                              Fill="#FFDDE6F2"
                                              HorizontalAlignment="Right"
                                              VerticalAlignment="Center"
                                              Margin="0,0,8,0"
                                              Data="M 0 0 L 4 4 L 8 0 Z"/>
                                    </ToggleButton>
                                    <ContentPresenter x:Name="ContentSite"
                                                      IsHitTestVisible="False"
                                                      Content="{TemplateBinding SelectionBoxItem}"
                                                      ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                      ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                      Margin="{TemplateBinding Padding}"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Left"/>
                                </Grid>
                            </Border>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="#FF2A3A4F"
                                            BorderThickness="1"
                                            BorderBrush="#FF3B4A5C"/>
                                    <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBoxItem Styling -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FFDDE6F2"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="ItemBorder"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#FF347DFF"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#FF223247"/>
                                <Setter Property="Foreground" Value="#FFDDE6F2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DatePicker Styling -->
        <Style TargetType="DatePicker">
            <Setter Property="Background" Value="#FF2A3A4F"/>
            <Setter Property="Foreground" Value="#FFDDE6F2"/>
            <Setter Property="BorderBrush" Value="#FF3B4A5C"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- TextBox Styling -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#FF2A3A4F"/>
            <Setter Property="Foreground" Value="#FFDDE6F2"/>
            <Setter Property="BorderBrush" Value="#FF3B4A5C"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="SelectionBrush" Value="#FF347DFF"/>
        </Style>

        <!-- DataGrid Row Selection Style -->
        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="#FF2A3A4F"/>
            <Setter Property="Foreground" Value="#FFDDE6F2"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FF347DFF"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF475B70"/>
                </Trigger>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsSelected" Value="True"/>
                        <Condition Property="IsMouseOver" Value="True"/>
                    </MultiTrigger.Conditions>
                    <Setter Property="Background" Value="#FF2E5BFF"/>
                </MultiTrigger>
            </Style.Triggers>
        </Style>

        <!-- DataGrid Cell Style -->
        <Style TargetType="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#FF223247" CornerRadius="4" Padding="10" Margin="0,0,0,10">
            <TextBlock Text="Recording Scheduler" FontSize="16" FontWeight="Bold"
                       Foreground="#FFDDE6F2" HorizontalAlignment="Center"/>
        </Border>

        <!-- Main Content -->
        <TabControl Grid.Row="1" Background="#FF1E2A3A" BorderBrush="#FF3B4A5C" BorderThickness="0,1,0,0">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="Border"
                                        Background="#FF2A3A4F"
                                        BorderBrush="#FF3B4A5C"
                                        BorderThickness="1,1,1,0"
                                        CornerRadius="4,4,0,0"
                                        Margin="0,0,2,0"
                                        Padding="15,8">
                                    <ContentPresenter x:Name="ContentSite"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Center"
                                                      ContentSource="Header"
                                                      Margin="0"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="#FF347DFF"/>
                                        <Setter TargetName="Border" Property="BorderBrush" Value="#FF347DFF"/>
                                        <Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="#FF3B4A5C"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <MultiTrigger>
                                        <MultiTrigger.Conditions>
                                            <Condition Property="IsSelected" Value="False"/>
                                        </MultiTrigger.Conditions>
                                        <Setter Property="Foreground" Value="#FFDDE6F2"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </MultiTrigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="FontSize" Value="12"/>
                </Style>
            </TabControl.Resources>

            <!-- Schedule New Recording Tab -->
            <TabItem Header="Schedule Recording">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Instructions -->
                    <TextBlock Grid.Row="0" Text="Choose how to schedule your recording:"
                               Foreground="#FFDDE6F2" FontSize="14" FontWeight="SemiBold"
                               Margin="0,0,0,10"/>

                    <!-- Recording Type Selection -->
                    <GroupBox Grid.Row="0" Header="Step 1: Recording Type" Foreground="#FFDDE6F2"
                              BorderBrush="#FF3B4A5C" Margin="0,25,0,10">
                        <StackPanel Margin="5">
                            <RadioButton x:Name="EpgRadio" Content="From TV Guide (EPG) - Select a show from the program guide"
                                         Foreground="#FF9DB2C7" Margin="0,0,0,8" IsChecked="True"
                                         Checked="RecordingType_Changed"/>
                            <RadioButton x:Name="CustomRadio" Content="Custom Time Range - Set your own start and end times"
                                         Foreground="#FF9DB2C7" Margin="0,0,0,5"
                                         Checked="RecordingType_Changed"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Recording Options -->
                    <Grid Grid.Row="1" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- EPG-based Recording Panel -->
                        <GroupBox x:Name="EpgPanel" Grid.Column="0" Header="Step 2a: Select from TV Guide"
                                  Foreground="#FFDDE6F2" BorderBrush="#FF3B4A5C" Margin="0,0,5,0">
                            <StackPanel Margin="5">
                                <TextBlock Text="1. Choose a channel:" Foreground="#FF9DB2C7" Margin="0,0,0,5"/>
                                <ComboBox x:Name="ChannelCombo"
                                          DisplayMemberPath="Name" SelectedValuePath="Id"
                                          SelectionChanged="ChannelCombo_SelectionChanged"/>

                                <TextBlock Text="2. Pick a show to record:" Foreground="#FF9DB2C7" Margin="0,10,0,5"/>
                                <ComboBox x:Name="ProgramCombo"
                                          DisplayMemberPath="Title" SelectedValuePath="Id"
                                          SelectionChanged="ProgramCombo_SelectionChanged"/>
                                <TextBlock x:Name="ProgramTimeText" Text="" Foreground="#FF6C757D"
                                           FontSize="11" Margin="0,2,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Custom Time Recording Panel -->
                        <GroupBox x:Name="CustomPanel" Grid.Column="1" Header="Step 2b: Set Custom Times"
                                  Foreground="#FFDDE6F2" BorderBrush="#FF3B4A5C" Margin="5,0,0,0"
                                  IsEnabled="False">
                            <Grid Margin="5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="1. Channel:"
                                           Foreground="#FF9DB2C7" Margin="0,0,10,5"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" x:Name="CustomChannelCombo"
                                          DisplayMemberPath="Name" SelectedValuePath="Id"
                                          SelectionChanged="CustomChannelCombo_SelectionChanged"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="2. Date:"
                                           Foreground="#FF9DB2C7" Margin="0,5,10,5"/>
                                <DatePicker Grid.Row="1" Grid.Column="1" x:Name="StartDatePicker"
                                             Foreground="Black" Margin="0,5,0,5"
                                            SelectedDateChanged="CustomTime_Changed"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="3. Start:"
                                           Foreground="#FF9DB2C7" Margin="0,0,10,5"/>
                                <TextBox Grid.Row="2" Grid.Column="1" x:Name="StartTimeBox"
                                         Text="20:00"
                                         ToolTip="Format: HH:mm (e.g., 20:00 for 8:00 PM)"
                                         TextChanged="CustomTime_Changed"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="4. End:"
                                           Foreground="#FF9DB2C7" Margin="0,5,10,5"/>
                                <TextBox Grid.Row="3" Grid.Column="1" x:Name="EndTimeBox"
                                         Text="21:00" Margin="0,5,0,0"
                                         ToolTip="Format: HH:mm (e.g., 21:00 for 9:00 PM)"
                                         TextChanged="CustomTime_Changed"/>
                            </Grid>
                        </GroupBox>
                    </Grid>

                    <!-- Recording Details -->
                    <GroupBox Grid.Row="2" Header="Step 3: Recording Settings" Foreground="#FFDDE6F2"
                              BorderBrush="#FF3B4A5C">
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Title:"
                                       Foreground="#FF9DB2C7" Margin="0,0,10,5"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="3" x:Name="TitleBox"
                                     Margin="0,0,0,5"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Pre-buffer (min):"
                                       Foreground="#FF9DB2C7" Margin="0,5,10,5"
                                       ToolTip="Minutes to start recording before the scheduled time"/>
                            <TextBox Grid.Row="1" Grid.Column="1" x:Name="PreBufferBox"
                                     Text="2" Margin="0,5,10,5"
                                     ToolTip="Start recording this many minutes early"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Post-buffer (min):"
                                       Foreground="#FF9DB2C7" Margin="0,5,10,5"
                                       ToolTip="Minutes to continue recording after the scheduled end time"/>
                            <TextBox Grid.Row="1" Grid.Column="3" x:Name="PostBufferBox"
                                     Text="5" Margin="0,5,0,5"
                                     ToolTip="Continue recording this many minutes past the end time"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Output File:"
                                       Foreground="#FF9DB2C7" Margin="0,5,10,10"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" x:Name="OutputFileBox"
                                     IsReadOnly="True" Margin="0,5,10,10"/>
                            <Button Grid.Row="2" Grid.Column="3" Content="Browse..."
                                    Background="#FF347DFF" Foreground="White"
                                    BorderBrush="#FF347DFF" Margin="0,5,0,10"
                                    Click="BrowseOutput_Click"/>

                            <Button Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2"
                                    Content="Schedule Recording" Background="#FF28A745"
                                    Foreground="White" BorderBrush="#FF28A745"
                                    Padding="15,8" Margin="0,10,0,0" HorizontalAlignment="Center"
                                    Click="ScheduleRecording_Click"/>
                        </Grid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- Scheduled Recordings Tab -->
            <TabItem Header="Scheduled Recordings">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Info and Toolbar -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,10">
                        <TextBlock Text="View and manage your scheduled recordings. The app automatically checks for recordings to start every 30 seconds."
                                   Foreground="#FF9DB2C7" FontSize="12" Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Refresh" Background="#FF347DFF" Foreground="White"
                                    BorderBrush="#FF347DFF" Padding="10,5" Margin="0,0,10,0"
                                    Click="RefreshScheduled_Click"/>
                            <Button Content="Delete Completed" Background="#FFDC3545" Foreground="White"
                                    BorderBrush="#FFDC3545" Padding="10,5"
                                    Click="DeleteCompleted_Click"
                                    ToolTip="Remove all completed, failed, and cancelled recordings from the list"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Scheduled Recordings List -->
                    <DataGrid Grid.Row="1" x:Name="ScheduledGrid" AutoGenerateColumns="False"
                              Background="#FF2A3A4F" Foreground="#FFDDE6F2"
                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                              RowBackground="#FF2A3A4F" AlternatingRowBackground="#FF223247"
                              BorderBrush="#FF3B4A5C" CanUserAddRows="False">
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#FF223247"/>
                                <Setter Property="Foreground" Value="#FFDDE6F2"/>
                                <Setter Property="BorderBrush" Value="#FF3B4A5C"/>
                                <Setter Property="Padding" Value="8,6"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*"/>
                            <DataGridTextColumn Header="Channel" Binding="{Binding ChannelName}" Width="120"/>
                            <DataGridTextColumn Header="Start Time" Binding="{Binding StartTimeLocal}" Width="140"/>
                            <DataGridTextColumn Header="End Time" Binding="{Binding EndTimeLocal}" Width="140"/>
                            <DataGridTextColumn Header="Duration" Binding="{Binding DurationText}" Width="80"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding StatusText}" Width="100"/>
                            <DataGridTemplateColumn Header="Actions" Width="180">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="Props" Background="#FF28A745"
                                                    BorderBrush="#FF28A745" Padding="4,2" Margin="0,0,2,0"
                                                    FontSize="9" ToolTip="Show recording properties"
                                                    Click="PropertiesRecording_Click"/>
                                            <Button Content="Edit" Background="#FF6C757D"
                                                    BorderBrush="#FF6C757D" Padding="4,2" Margin="0,0,2,0"
                                                    IsEnabled="{Binding CanEdit}" FontSize="9"
                                                    Click="EditRecording_Click"/>
                                            <Button Content="Cancel" Background="#FFDC3545" 
                                                    BorderBrush="#FFDC3545" Padding="4,2" FontSize="9"
                                                    IsEnabled="{Binding CanCancel}"
                                                    Click="CancelRecording_Click"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Footer Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Close" Background="#FF6C757D" Foreground="White"
                    BorderBrush="#FF6C757D" Padding="15,8" Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>